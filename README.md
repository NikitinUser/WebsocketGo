# DockerGo

1. sudo make up || sudo make compose



1. АУТЕНТИФИКАЦИЯ
2. принимать множество постоянных ws соединений
3. ХРАНЕНИЕ СОЕДИНЕНИЙ
4. ежеминутная отправка ПИНГ от сервера получение ПОНГ от клиента
5. удаление коннектов из мап в случае разрыва соединений
4. ПОЛУЧЕНИЕ СООБЩЕНИЙ ОТ ОСНОВНОЙ СИСТЕМЫ
5. от клиента мы получаем только ПОНГ
6. логировать коннекты
7. логировать сообщения переданные/полученные из очереди

АУТЕНТИФИКАЦИЯ:
есть аутентифицированный в системе Х клиент
он делает запрос на get /ws/ticket в системе Х
система проверяет токен и если все ок генерирует одноразовый тикет привязанный к ip, кладет его в общий с вебсокет сервером редис и отдает его на клиент
тикет передается в query параметре для ws соединения
если тикет и айпи валидны то держим коннект

ХРАНЕНИЕ СОЕДИНЕНИЙ
каждое соединение должно ассоциироваться с пользователем в системе (пусть будет айди)
каждый пользователь должен распределяться на группы (общее - для всех вообще, и по группам доступа (roles and permissions) к контенту аналогичное middleware в системе Х)
должен быть глобальный мап в котором айди это ключ, а в значении массив коннектов и массивы групп для хранения соединений

ПОЛУЧЕНИЕ СООБЩЕНИЙ ОТ ОСНОВНОЙ СИСТЕМЫ
на сервере должен быть один коннект к кролику, к одной очереди (output)
когда сервер вычитывает сообщение он должен понять к какому пользователю (по айди) или к какой группе коннектов он должен его передать
берем айди, находим его в мапе, отправляем всем коннектам в массиве по очереди или берем массив для группа
если нет айди, нет коннектов и тд то сообщение пропускаем

КАКИЕ ЗАДАЧИ РЕШАЕТ:
1. Получение новой информации не привязанной к сущностям, но привязанной к группам (рассылки, формирование файлов, групповые чаты, статусы дэщбордов)
2. Получение новой информации привязанной к сущностям (личные сообщения от пользователя, изменение личной информации пользователя)


{
    mode: [
        all // all connected
        touser // userid requered
        group // message for specific connected group - todo
    ]
    userid: string // optional, required if mode is touser
    message: string // data for websocket client
}



